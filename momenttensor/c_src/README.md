# About

This is a C translation of some of Carl Tape's compearth Matlab scripts.  These functions are particularly useful when discretizing uniform moment tensor spaces or performing moment tensor decompositions in a compiled language such as C or Fortran.

# Prerequisites

An effort was made to make this library largely free of many dependencies.  However, there still remain some required items which are detailed in the following list

* [CMake](https://cmake.org/) v2.6 or greater.
* A valid C11 compiler
* [LAPACK(E)](http://www.netlib.org/lapack/) and [(C)BLAS](http://www.netlib.org/blas/) along with header files.  Vendor implementations are recommended when available.
* When using Intel processors BLAS, CBLAS, LAPACK, LAPACKE, and the requisite header files are available at Intel's [MKL](https://software.intel.com/en-us/mkl).  This library is available at no cost.
* [Doxygen](http://www.stack.nl/~dimitri/doxygen/).  This is only required if you wish to generate the API documentation.
  
The purpose of CMake is to serve as a cross-platform Makefile generator.  CMake, however, can be difficult to use.  I usually find the most expedient strategy is to create configuration scripts.  For eample, to configure with clang one could run the following script in the root source directory 


    #!/bin/bash
    /usr/bin/cmake ./ -DCMAKE_BUILD_TYPE=DEBUG \
    -DCMAKE_INSTALL_PREFIX=./ \
    -DCMAKE_C_COMPILER=clang \
    -DCMAKE_C_FLAGS="-g3 -O2 -fopenmp -Weverything" \
    -DLAPACKE_INCLUDE_DIR=/usr/include \
    -DLAPACKE_LIBRARY=/usr/lib/liblapacke.so \
    -DLAPACK_LIBRARY=/usr/lib/liblapack.so \
    -DCBLAS_INCLUDE_DIR=/usr/include \
    -DCBLAS_LIBRARY=/usr/lib/libblas.so \
    -DBLAS_LIBRARY=/usr/lib/libblas.so

Alternatively, to configure with MKL and the Intel C and Fortran compilers I would do something like:

    #!/bin/bash
    /usr/bin/cmake ./ -DCMAKE_BUILD_TYPE=Release \
    -DCMAKE_INSTALL_PREFIX=./ \
    -DCMAKE_C_COMPILER=icc \
    -DCMAKE_Fortran_COMPILER=ifort \
    -DCOMPEARTH_MAKE_FINTER=TRUE \
    -DCMAKE_C_FLAGS="-g3 -xHOST -O3 -ipo -qopenmp -Wall -Wextra -Wcomment -Wcheck" \
    -DCMAKE_Fortran_FLAGS="-g2 -O2" \
    -DCOMPEARTH_USE_MKL=TRUE \
    -DMKL_LIBRARY="/opt/intel/mkl/lib/intel64_lin/libmkl_intel_lp64.so;/opt/intel/mkl/lib/intel64_lin/libmkl_sequential.so;/opt/intel/mkl/lib/intel64_lin/libmkl_core.so" \
    -DMKL_INCLUDE_DIR=/opt/intel/mkl/include

## Experimental Python Interfacing

With [SWIG](http://www.swig.org/) and [NumPy](http://www.numpy.org/)it may be possible to wrap some components of the library for use from Python.  In this instance a configuration script may look like

    #!/bin/bash
    /usr/bin/cmake ./ -DCMAKE_BUILD_TYPE=Release \
    -DCMAKE_INSTALL_PREFIX=./ \
    -DCMAKE_C_COMPILER=icc \
    -DCOMPEARTH_BUILD_PYTHON_MODULE=TRUE \
    -DSWIG_EXECUTABLE=/usr/bin/swig \
    -DCMAKE_C_FLAGS="-g3 -xHOST -O3 -ipo -qopenmp -Wall -Wextra -Wcomment -Wcheck" \
    -DCOMPEARTH_USE_MKL=TRUE \
    -DMKL_LIBRARY="/opt/intel/mkl/lib/intel64_lin/libmkl_intel_lp64.so;/opt/intel/mkl/lib/intel64_lin/libmkl_sequential.so;/opt/intel/mkl/lib/intel64_lin/libmkl_core.so;/opt/intel/mkl/lib/intel64_lin/libmkl_mc3.so;/opt/intel/lib/intel64_lin/libmkl_def.so" \
    -DMKL_INCLUDE_DIR=/opt/intel/mkl/include

After configuration the application can be built in the source root directory by typing

    make

and, assuming root privelages are not required, installed by typing 

    make install

The Doxygen documentation can be generated by typing

    doxygen Doxyfile

from the source root directory.

# TODO List

The library is still limited in some aspects.  The following  

* Add more interface modules.  Deal with NULLs.  Might need Fortran pointers.  Yick.
* Extend unit tests to chunks of matrices
* Compute intelligent chunk sizes

